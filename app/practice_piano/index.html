<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Karl Hiner - Practice piano</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Karl Hiner">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap core CSS -->
    <link href="../components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../styles/main.css" rel="stylesheet">
  </head>

  <body>
    <div id="main_nav"></div>
    <div class="container main_contents">
      <div class="practice-list-parent col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4">
        <ul class="vertical-list sortable">
          <li id='five_finger' class="row list-group-item practice-type-group">
            <div class="col-xs-6 list-child practice-type">Five-finger pattern</div>
            <div class="col-xs-6 list-child time-dropdown-group"></div>
          </li>
          <li id='scales' class="row list-group-item practice-type-group">
            <div class="col-xs-6 list-child practice-type">Scales</div>
            <div class="col-xs-6 list-child time-dropdown-group"></div>
          </li>
          <li id='chords' class="row list-group-item practice-type-group">
            <div class="col-xs-6 list-child practice-type">Chords</div>
            <div class="col-xs-6 list-child time-dropdown-group"></div>
          </li>
          <li id='ear_training' class="row list-group-item practice-type-group">
            <div class="col-xs-6 list-child practice-type">Ear training</div>
            <div class="col-xs-6 list-child time-dropdown-group"></div>
          </li>
          <li id='sight_reading' class="row list-group-item practice-type-group">
            <div class="col-xs-6 list-child practice-type">Sight reading</div>
            <div class="col-xs-6 list-child time-dropdown-group"></div>
          </li>
        </ul>
        <button id="start" class="btn btn-default btn-lg" type="button">Start</button>
      </div>

    </div>
    <script src="/components/jquery/dist/jquery.min.js"></script>
    <script src="/components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://rawgit.com/RubaXa/Sortable/master/Sortable.js"></script>

    <script type="text/javascript">
      $(document).ready(function() { $('#main_nav').load('../../main_nav.html'); });
      $(document).ready(function() { $('.time-dropdown-group').load('time_dropdown_group.html'); });

      new Sortable($('.sortable')[0]);

      var keys = [
        'C', 'G', 'D', 'A', 'E', 'B', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F'
      ];

      var triadTypes = [
        'maj', 'min', 'aug', 'dim'
      ]

      var audioForKeys = {};
      keys.forEach(function(key) {
        audioForKeys[key] = new Audio('audio/' + key + '.mp3');
      });

      var practiceTimes = {};
      var practiceTypes = [];
      var practiceTimeMillis;
      var currKeyIndex;
      var interval = null;

      function minutesToMillis(minutes) {
        return minutes * 60 * 1000;
      }

      function sample(array) {
        return array[Math.floor(Math.random() * array.length)];
      }

      function loadPracticePage(practiceTypeIndex) {
        var practiceType = practiceTypes[practiceTypeIndex];
        practiceTimeMillis = practiceTimes[practiceType];
        currKeyIndex = 0;

        if (interval != null) {
          clearInterval(interval);
        }
        $('.main_contents').load(practiceType + '.html');
        if (practiceTypeIndex < practiceTypes.length - 1) {
          setTimeout(function() { loadPracticePage(practiceTypeIndex + 1) }, practiceTimeMillis);
        }
      }

      function displayNextKey() {
        if (currKeyIndex >= keys.length)
          return;

        var key = keys[currKeyIndex++];
        audioForKeys[key].play();
        $('#key').text(key);
      }

      function displayNextChord() {
        var key = sample(keys);
        var triadType = sample(triadTypes);
        audioForKeys[key].play();
        $('#chord').text(key + triadType);
      }

      $('#start').on('click', function() {
        $('.practice-type-group').each(function() {
          var practiceType = $(this).attr('id');
          var timeMinutes = +$(this).find('.time-value').text();
          practiceTimes[practiceType] = minutesToMillis(timeMinutes);
          practiceTypes.push(practiceType);
        });

        loadPracticePage(0);
      });
    </script>
  </body>
</html>
